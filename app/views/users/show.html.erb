<div class="profile-page-background">
  <div class="profile-page">
    <h1 class="profile-username">プロフィール</h1>

    <div class="profile-image-container">
      <% if @user.profile_image.attached? %>
        <%= image_tag @user.profile_image.variant(resize_to_fill: [300, 300]), class: "profile-image" %>
      <% else %>
        <%= image_tag 'no_image_photo.jpg', size: "300x300", class: "profile-image" %>
      <% end %>
    </div>

    <div class="profile-details">
      <table class="profile-table">
        <tr>
          <th>ユーザーネーム</th>
          <td><%= @user.username.presence || '未設定' %></td>
        </tr>
        <tr>
          <th>性別</th>
          <td><%= @user.gender.presence || '未設定' %></td>
        </tr>
        <tr>
          <th>年齢</th>
          <td><%= @user.age.presence || '未設定' %></td>
        </tr>
        <tr>
          <th>誕生日</th>
          <td><%= @user.birthdate.presence || '未設定' %></td>
        </tr>
        <tr>
          <th>自己紹介</th>
          <td><%= @user.bio.presence || '未設定' %></td>
        </tr>
      </table>
    </div>

    <% if current_user == @user %>
      <div class="profile-actions">
        <%= link_to 'プロフィールを編集', edit_user_path(@user.id), class: 'btn btn-primary' %>
      </div>
    <% end %>
  </div>

  <div class="profile-posts-page">
    <div class="profile-posts-title">
      <h2>ユーザーの投稿一覧</h2>
    </div>
    
    <% if current_user == @user %>
      <div class="new-post-link">
        <%= link_to '新規投稿', new_post_path, class: 'btn btn-primary' %>
      </div>
    <% end %>

    <div class="posts-grid">
      <% if @posts.any? %>
        <% @posts.each do |post| %>

          <div class="post-item">

            <div class="post-user-info">
              <% if post.user.profile_image.attached? %>
                <%= image_tag post.user.profile_image.variant(resize_to_fill: [30, 30]), class: 'user-icon' %>
              <% else %>
                <%= image_tag 'no_image_photo.jpg', size: "30x30", class: 'user-icon' %>
              <% end %>
              <%= link_to post.user.username, user_path(post.user.id), class: 'post-username' %>
              
            </div>

            

            <h3 class="post-title"><%= link_to truncate(post.title, length: 40), post_path(post), class: 'post-title-link' %></h3>
              <% if post.title.length > 40 %>
                <%= link_to '続きを読む', post_path(post), class: 'post-link' %>
              <% end %>


            <p class="post-description">
              <%= truncate(post.description, length: 100) %>
              <% if post.description.length > 100 %>
                <%= link_to '続きを読む', post_path(post), class: 'post-link' %>
              <% end %>
            </p>

            <% if post.image.attached? %>
              <p class="post-image">
                <%= link_to post_path(post) do %>
                  <%= image_tag post.display_image, class: 'post-img' %>
                <% end %>
              </p>
            <% else %>
              <p class="post-image">
                <%= link_to post_path(post) do %>
                  <%= image_tag 'no_image_photo1.jpg', class: 'post-img' %>
                <% end %>
              </p>
            <% end %>
            
            <p class="post-date">
              <%= post.created_at.in_time_zone('Asia/Tokyo').strftime("%Y年%m月%d日 %H:%M") %>
            </p>

            
          </div>
        <% end %>
      <% else %>
        <p class="no-posts">投稿がありません。</p>
      <% end %>
    </div>
    <div class="pagination-empty">
    <%= paginate @posts, theme: 'bootstrap4', total_pages: (@posts.total_pages > 1 ? @posts.total_pages : 2) %>
    </div>
  </div>
</div>
